#textdomain wesnoth-loti
#define SOUL_EATER
    [event]
        name=die
        first_time_only=no

        [filter_second]
            ability=soul eater
            [or]
                ability=feeding_optimised
            [/or]
        [/filter_second]
        [store_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
            variable=eater
        [/store_unit]
        [if]
            [variable]
                name=eater.variables.max_devour_count
                greater_than=0
            [/variable]
            [else]
                {VARIABLE eater.variables.max_devour_count 30}
#ifver WESNOTH_VERSION >= 1.13.2
                {FOREACH eater.modifications.advancement i}
#else
                {FOREACH eater.modifications.advance i}
#endif
                    [if]
                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                            name=eater.modifications.advancement[$i].id
#else
                            name=eater.modifications.advance[$i].id
#endif
                            equals="lightning"
                        [/variable]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="fireball"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="thunder"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="meteor"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="chill"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="shadowwave"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="resist_fire"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="resist_cold"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="resist_arcane"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="resist_blade"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="resist_pierce"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="resist_impact"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="health"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="regeneration"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="absorb"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="heal"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="leadership"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="spirit"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="fire_penetrate"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="cold_penetrate"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="arcane_penetrate"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="blade_penetrate"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="impact_penetrate"
                            [/variable]
                        [/or]
                        [or]
                            [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                name=eater.modifications.advancement[$i].id
#else
                                name=eater.modifications.advance[$i].id
#endif
                                equals="pierce_penetrate"
                            [/variable]
                        [/or]
                        [then]
                            {VARIABLE_OP eater.variables.max_devour_count multiply 3}
                            [set_variable]
                                name=eater.variables.max_devour_count
                                divide=2
                                round=floor
                            [/set_variable]
                        [/then]
                    [/if]
                {NEXT i}
            [/else]
        [/if]
        [if]
            [variable]
                name=eater.variables.devour_count
                greater_than=0
            [/variable]
            [then]
                {VARIABLE_OP eater.variables.devour_count add 1}
                [if]
                    [variable]
                        name=eater.variables.devour_count
                        greater_than_equal_to=$eater.variables.max_devour_count
                    [/variable]
                    [then]
#ifdef MULTIPLAYER
                        [if]
                            [variable]
                                name=side_number
                                equals=$eater.side
                            [/variable]
                            [then]
#endif
                                {VARIABLE question.question _"<span size='large'>Which new advancement path should our victorious unit get?</span>"}

#ifver WESNOTH_VERSION >= 1.13.2
                                {FOREACH eater.modifications.advancement i}
#else
                                {FOREACH eater.modifications.advance i}
#endif
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="lightning"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.lightning 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="thunder"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.thunder 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="fireball"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.fireball 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="meteor"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.meteor 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="chill"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.chill 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="shadowwave"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.shadowwave 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="resist_fire"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.resist_fire 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="resist_cold"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.resist_cold 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="resist_arcane"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.resist_arcane 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="resist_blade"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.resist_blade 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="resist_pierce"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.resist_pierce 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="resist_impact"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.resist_impact 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="health"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.health 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="regeneration"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.regeneration 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="absorb"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.absorb 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="heal"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.heal 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="spirit"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.spirit 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="leadership"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.leadership 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="fire_penetrate"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.fire_penetrate 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="cold_penetrate"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.cold_penetrate 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="arcane_penetrate"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.arcane_penetrate 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="blade_penetrate"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.blade_penetrate 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="impact_penetrate"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.impact_penetrate 1}
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
#ifver WESNOTH_VERSION >= 1.13.2
                                            name=eater.modifications.advancement[$i].id
#else
                                            name=eater.modifications.advance[$i].id
#endif
                                            equals="pierce_penetrate"
                                        [/variable]
                                        [then]
                                            {VARIABLE has.pierce_penetrate 1}
                                        [/then]
                                    [/if]
                                {NEXT i}
                                [if]
                                    [variable]
                                        name=has.fireball
                                        equals=1
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=has.chill
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Lightning requires fireball and chill wave"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.fireball
                                        equals=1
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=has.chill
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [and]
                                        [variable]
                                            name=has.lightning
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Thunder requires fireball, chill wave and lightning"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.fireball
                                        equals=1
                                    [/variable]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Meteor requires fireball"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.meteor
                                        equals=1
                                    [/variable]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Fire resistance penetration requires meteor"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.chill
                                        equals=1
                                    [/variable]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Shadow wave requires chill wave"}
                                        {VARIABLE question[$question.length].question _"Cold resistance penetration requires chill tempest"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.fireball
                                        equals=1
                                    [/variable]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Resist fire requires fireball"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.chill
                                        equals=1
                                    [/variable]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Resist cold requires chill tempest"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.shadowwave
                                        equals=1
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=has.chill
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Resist arcane requires chill tempest and shadow wave"}
                                        {VARIABLE question[$question.length].question _"Arcane resistance penetration requires chill tempest and shadow wave"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.health
                                        equals=1
                                    [/variable]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Resist blade requires health"}
                                        {VARIABLE question[$question.length].question _"Resist pierce requires health"}
                                        {VARIABLE question[$question.length].question _"Resist impact requires health"}
                                        {VARIABLE question[$question.length].question _"Regeneration requires health"}
                                        {VARIABLE question[$question.length].question _"Blade resistance penetration requires health"}
                                        {VARIABLE question[$question.length].question _"Pierce resistance penetration requires health"}
                                        {VARIABLE question[$question.length].question _"Impact resistance penetration requires health"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.health
                                        equals=1
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=has.regeneration
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Absorb requires health and regeneration"}
                                    [/else]
                                [/if]
                                [if]
                                    [variable]
                                        name=has.health
                                        equals=1
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=has.regeneration
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [and]
                                        [variable]
                                            name=has.absorb
                                            equals=1
                                        [/variable]
                                    [/and]
                                    [else]
                                        {VARIABLE question[$question.length].question _"Spiritual transformation requires health, absorb and regeneration"}
                                    [/else]
                                [/if]
                                [set_variable]
                                    name=question_asked
                                    [join]
                                        variable=question
                                        key=question
                                        separator="
"
                                        remove_empty=yes
                                    [/join]
                                [/set_variable]
                                {VARIABLE chose 0}
                                [message]
                                    speaker=narrator
                                    message= _ "$question_asked"
                                    [option]
                                        message=_ "Spiritual transformation (a very powerful combat technique)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id spirit}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id spirit}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.spirit
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.regeneration
                                                    equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.absorb
                                                    equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Regeneration (advancements improving the regeneration)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id regeneration}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id regeneration}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.regeneration
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Absorbtion (advancements that allow the unit heal from enemy attacks)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id absorb}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id absorb}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.absorb
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.regeneration
                                                    equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Lightning (high damage, few attacks, can get firststrike)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id lightning}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id lightning}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.lightning
                                                not_equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.fireball
                                                    equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.chill
                                                    equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Thunder (high damage, explosive, great area of effect, only a very few attacks)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id thunder}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id thunder}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.lightning
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.thunder
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.fireball
                                                    equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.chill
                                                    equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Fireball (quite powerful fiery attack)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id fireball}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id fireball}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.fireball
                                                not_equals=1
                                            [/variable]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Meteor (great damage, range and precision, only one attack)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id meteor}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id meteor}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.fireball
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.meteor
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Fire resistance penetration"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id fire_penetrate}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id fire_penetrate}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.meteor
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.fire_penetrate
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Chill tempest (capable to slow a lot of units)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id chill}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id chill}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.chill
                                                not_equals=1
                                            [/variable]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Cold resistance penetration"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id cold_penetrate}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id cold_penetrate}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.chill
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.cold_penetrate
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Shadow wave (can become a powerful draining ability)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id shadowwave}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id shadowwave}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.chill
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.shadowwave
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Arcane resistance penetration"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id arcane_penetrate}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id arcane_penetrate}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.shadowwave
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.arcane_penetrate
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Resist fire"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id resist_fire}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id resist_fire}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.fireball
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.resist_fire
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Resist cold"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id resist_cold}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id resist_cold}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.chill
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.resist_cold
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Resist arcane"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id resist_arcane}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id resist_arcane}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.shadowwave
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.chill
                                                    equals=1
                                                [/variable]
                                            [/and]
                                            [and]
                                                [variable]
                                                    name=has.resist_arcane
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Health (+10 to HP advancements)"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id health}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id health}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                not_equals=1
                                            [/variable]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Leadership"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id leadership}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id leadership}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.leadership
                                                not_equals=1
                                            [/variable]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Healing others"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id heal}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id heal}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.heal
                                                not_equals=1
                                            [/variable]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Blade resistance penetration"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id blade_penetrate}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id blade_penetrate}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.blade_penetrate
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Impact resistance penetration"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id impact_penetrate}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id impact_penetrate}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.impact_penetrate
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Pierce resistance penetration"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id pierce_penetrate}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id pierce_penetrate}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.pierce_penetrate
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Resist blade"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id resist_blade}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id resist_blade}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.resist_blade
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Resist pierce"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id resist_pierce}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id resist_pierce}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.resist_pierce
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                    [option]
                                        message=_ "Resist impact"
                                        [command]
#ifver WESNOTH_VERSION >= 1.13.2
                                            {VARIABLE eater.modifications.advancement[$eater.modifications.advancement.length].id resist_impact}
#else
                                            {VARIABLE eater.modifications.advance[$eater.modifications.advance.length].id resist_impact}
#endif
                                            {VARIABLE chose 1}
                                        [/command]
                                        [show_if]
                                            [variable]
                                                name=has.health
                                                equals=1
                                            [/variable]
                                            [and]
                                                [variable]
                                                    name=has.resist_impact
                                                    not_equals=1
                                                [/variable]
                                            [/and]
                                        [/show_if]
                                    [/option]
                                [/message]
                                [if]
                                    [variable]
                                        name=chose
                                        equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE_OP eater.variables.devour_count sub $eater.variables.max_devour_count}
                                        [if]
                                            [variable]
                                                name=eater.variables.devour_count
                                                less_than=0
                                            [/variable]
                                            [then]
                                                {VARIABLE eater.variables.devour_count 0}
                                            [/then]
                                        [/if]
                                        {VARIABLE_OP eater.variables.max_devour_count multiply 3}
                                        [set_variable]
                                            name=eater.variables.max_devour_count
                                            divide=2
                                            round=floor
                                        [/set_variable]
                                        {VARIABLE question_asked "$eater.variables.devour_count|/$eater.variables.max_devour_count"}
                                        {CLEAR_VARIABLE eater.variables.max_devour_count}	#Will be reviewed later, for possible errors
                                    [/then]
                                    [else]
                                        {VARIABLE question_asked "$eater.variables.devour_count|/$eater.variables.max_devour_count"}
                                    [/else]
                                [/if]
                                [unstore_unit]
                                    variable=eater
                                    {COLOR_HEAL}
                                    text="$question_asked"
                                    find_vacant=no
                                    advance=no
                                [/unstore_unit]
#ifdef MULTIPLAYER
                            [/then]
                            [else]
                                [unstore_unit]
                                    variable=eater
                                    {COLOR_HEAL}
                                    text="$eater.variables.devour_count|/$eater.variables.max_devour_count"
                                    find_vacant=no
                                    advance=no
                                [/unstore_unit]
                            [/else]
                        [/if]
#endif
                    [/then]
                    [else]
                        [unstore_unit]
                            variable=eater
                            {COLOR_HEAL}
                            text="$eater.variables.devour_count|/$eater.variables.max_devour_count"
                            find_vacant=no
                            advance=no
                        [/unstore_unit]
                    [/else]
                [/if]
            [/then]
            [else]
                {VARIABLE eater.variables.devour_count 1}
                [unstore_unit]
                    variable=eater
                    {COLOR_HEAL}
                    text="$eater.variables.devour_count|/$eater.variables.max_devour_count"
                    find_vacant=no
                    advance=no
                [/unstore_unit]
            [/else]
        [/if]
        {CLEAR_VARIABLE eater,has,question,question_asked}
    [/event]
#enddef
